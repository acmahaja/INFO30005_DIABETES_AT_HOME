<title>Clinician Dashboard</title>
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/patient_add_info.css" />
<link rel="stylesheet" href="/css/patient_sidebar.css" />


<body>
  {{> sidebarPatient firstname=patient.firstname lastname=patient.lastname profile-img="https://this-person-does-not-exist.com/img/avatar-e2ba3bde87eee2ff3addbb339508a07d.jpg"}}
    
    
    <section class="wrapper">
        <p class="title">New Entry</p>
        <p class="subheading"><div class="day"> <div id="week_day"></div> <div id="date"></div> </div></p>

        
        <section>
            <div class="flex-entry-container">
                <div class="entry-box">

                </div>
            </div>
            
            <ul class="flex-entry-container wrap">
                {{log this}}
                {{!-- GLUCOSE BOX --}}
                {{#if patientsettings.requires_glucose}}
                    <div class="entry-flex-item">
                        <img class="entry-img" src="/images/sidebar/home_black.svg" alt="">
                        <p class="entry-name">Blood Glucose</p>
                        {{#if entry.glucose}}
                            <p class="entry-value">{{entry.glucose.value}} nmo/L</p>
                            <div class="entry-comment">
                                <p>Daily comment:</p>
                                {{#if entry.glucose.comment}}
                                    <textarea name="text_input" readonly="true" rows="3">{{entry.glucose.comment}}</textarea>
                                {{else}}
                                    <textarea name="text_input" readonly="true" rows="3"></textarea>
                                {{/if}}
                            </div>
                                    <input id="data-field" type="hidden" name="user_id" value={{patient._id}}>
                                    <input id="data-field" type="hidden" name="health_type" value={{entrytypes.glucose}}>
                                  <button class="input-entry-button" onclick="overlayOn('update', '{{patient._id}}', '{{entrytypes.glucose}}')">Update Entry</button>

                        {{else}}
                        <p class="entry-value">---</p>
                            <div class="entry-comment">
                                <p>Daily comment:</p>
                                <textarea name="text_input" readonly="true" rows="3"></textarea>
                            </div>
                                <input id="data-field" type="hidden" name="user_id" value={{patient._id}}>
                                <input id="data-field" type="hidden" name="health_type" value={{entrytypes.glucose}}>
                                <button class="input-entry-button" onclick="overlayOn('add', '{{patient._id}}', '{{entrytypes.glucose}}')">Add Entry</button>
                        {{/if}}
                    </div>
                {{/if}}

                {{!-- INSULIN BOX --}}
                {{#if patientsettings.requires_insulin}}
                    <div class="entry-flex-item">
                        <img class="entry-img" src="/images/sidebar/home_black.svg" alt="">
                        <p class="entry-name">Insulin</p>
                        {{#if entry.insulin}}
                            <p class="entry-value">{{entry.insulin.value}} doses</p>
                            <div class="entry-comment">
                                <p>Daily comment:</p>
                                {{#if entry.insulin.comment}}
                                    <textarea name="text_input" readonly="true" rows="3">{{entry.insulin.comment}}</textarea>
                                {{else}}
                                    <textarea name="text_input" readonly="true" rows="3"></textarea>
                                {{/if}}
                            </div>
                                <input id="data-field" type="hidden" name="user_id" value={{patient._id}}>
                                <input id="data-field" type="hidden" name="health_type" value={{entrytypes.insulin}}>
                                <button class="input-entry-button" onclick="overlayOn('update', '{{patient._id}}', '{{entrytypes.insulin}}')">Update Entry</button>
                        {{else}}
                        <p class="entry-value">---</p>
                            <div class="entry-comment">
                                <p>Daily comment:</p>
                                <textarea name="text_input" readonly="true" rows="3"></textarea>
                            </div>
                                <input id="data-field" type="hidden" name="user_id" value={{patient._id}}>
                                <input id="data-field" type="hidden" name="health_type" value={{entrytypes.insulin}}>
                                <button class="input-entry-button" onclick="overlayOn('add', '{{patient._id}}', '{{entrytypes.insulin}}')">Add Entry</button>
                        {{/if}}
                    </div>
                {{/if}}

                {{!-- WEIGHT BOX --}}
                {{#if patientsettings.requires_weight}}
                    <div class="entry-flex-item">
                        <img class="entry-img" src="/images/sidebar/home_black.svg" alt="">
                        <p class="entry-name">Weight</p>
                        {{#if entry.weight}}
                            <p class="entry-value">{{entry.weight.value}} kg</p>
                            <div class="entry-comment">
                                <p>Daily comment:</p>
                                {{#if entry.weight.comment}}
                                    <textarea name="text_input" readonly="true" rows="3">{{entry.weight.comment}}</textarea>
                                {{else}}
                                    <textarea name="text_input" readonly="true" rows="3"></textarea>
                                {{/if}}
                            </div>
                                <input id="data-field" type="hidden" name="user_id" value={{patient._id}}>
                                <input id="data-field" type="hidden" name="health_type" value={{entrytypes.weight}}>
                                <button class="input-entry-button" onclick="overlayOn('update', '{{patient._id}}', '{{entrytypes.weight}}')">Update Entry</button>
                        {{else}}
                        <p class="entry-value">---</p>
                            <div class="entry-comment">
                                <p>Daily comment:</p>
                                <textarea name="text_input" readonly="true" rows="3"></textarea>
                            </div>
                                <input id="data-field" type="hidden" name="user_id" value={{patient._id}}>
                                <input id="data-field" type="hidden" name="health_type" value={{entrytypes.weight}}>
                                <button class="input-entry-button" onclick="overlayOn('add', '{{patient._id}}', '{{entrytypes.weight}}')">Add Entry</button>
                        {{/if}}
                    </div>
                {{/if}}

                {{!-- STEPS BOX --}}
                {{#if patientsettings.requires_steps}}
                    <div class="entry-flex-item">
                        <img class="entry-img" src="/images/sidebar/home_black.svg" alt="">
                        <p class="entry-name">Steps</p>
                        {{#if entry.steps}}
                            <p class="entry-value">{{entry.steps.value}} steps</p>
                            <div class="entry-comment">
                                <p>Daily comment:</p>
                                {{#if entry.steps.comment}}
                                    <textarea name="text_input" readonly="true" rows="3">{{entry.steps.comment}}</textarea>
                                {{else}}
                                    <textarea name="text_input" readonly="true" rows="3"></textarea>
                                {{/if}}
                            </div>
                                <input id="data-field" type="hidden" name="user_id" value={{patient._id}}>
                                <input id="data-field" type="hidden" name="health_type" value={{entrytypes.steps}}>
                                <button class="input-entry-button" onclick="overlayOn('update', '{{patient._id}}', '{{entrytypes.steps}}')">Update Entry</button>
                        {{else}}
                        <p class="entry-value">---</p>
                            <div class="entry-comment">
                                <p>Daily comment:</p>
                                <textarea name="text_input" readonly="true" rows="3"></textarea>
                            </div>
                                <input id="data-field" type="hidden" name="user_id" value={{patient._id}}>
                                <input id="data-field" type="hidden" name="health_type" value={{entrytypes.steps}}>
                                <button class="input-entry-button" onclick="overlayOn('add', '{{patient._id}}', '{{entrytypes.steps}}')">Add Entry</button>
                        {{/if}}
                    </div>
                {{/if}}
            </ul>
        </section>
    </section>


    {{!-- OVERLAY --}}
    <div id="overlay" onclick="overlayOff()">
        <div class="entry-flex-item", id="overlay-input-box">
            <p id="overlay-entry-name" class="entry-name">Blood Glucose</p>
            <form id="input-post-form" method="post" action="">
                <div id="value-field">
                    <a id="value-field-anchor">New Entry:</a>
                    <input id="overlay-number-input" type="number" value="" name="data_input">
                    <span id="data-input-unit"></span>
                </div>
                <div id="textarea-field">
                    <a id="textarea-anchor">Daily Comment:</a>
                    <textarea rows="4" cols="26" name="text_input"></textarea>
                </div>
                <input id="overlay-operation-info" type="hidden" name="operation" value="">
                <input id="overlay-data-field-userid" type="hidden" name="user_id">
                <input id="overlay-data-field-healthtype" type="hidden" name="health_type" >
                <div id="overlay-buttons">
                    <input id="overlay-submit-button" type="Submit" value="" onclick="checkValueInput()">
                    <input type="button" value="Cancel" onclick="overlayOff()">
                </div>
            </form>
        </div>
    </div>

</body>


{{!-- OVERLAY SCRIPT --}}
<script>
    overlayInputBox = document.getElementById("overlay-input-box")
    overlayInputBox.addEventListener("click", function(e) {
        e.stopPropagation();
    });

    function overlayOn(call, user_id, health_type) {
        document.getElementById("overlay").style.display = "flex";
        formElement = document.getElementById("input-post-form");
        if(call == "add") {
            formElement.action = "/patient/dataentry/add/save"
            document.getElementById("overlay-submit-button").value = "Add"
            document.getElementById("overlay-operation-info").value = "add"
        }
        else {
            formElement.action = "/patient/dataentry/update/save"
            document.getElementById("overlay-submit-button").value = "Update"
            document.getElementById("overlay-operation-info").value = "update"
        }

        document.getElementById("overlay-data-field-userid").value=user_id;
        document.getElementById("overlay-data-field-healthtype").value=health_type;

        switch (health_type){
            case "blood_glucose":
                document.getElementById("overlay-entry-name").innerText = call.charAt(0).toUpperCase() + call.slice(1) + " Blood Glucose"
                document.getElementById("data-input-unit").innerText = " nmo/L"
                break;
            case "insulin":
                document.getElementById("overlay-entry-name").innerText = call.charAt(0).toUpperCase() + call.slice(1) + " Insulin"
                document.getElementById("data-input-unit").innerText = " doses"
                break;
            case "weight":
                document.getElementById("overlay-entry-name").innerText = call.charAt(0).toUpperCase() + call.slice(1) + " Weight"
                document.getElementById("data-input-unit").innerText = " kg"
                break;
            case "steps":
                document.getElementById("overlay-entry-name").innerText = call.charAt(0).toUpperCase() + call.slice(1) + " Steps"
                document.getElementById("data-input-unit").innerText = " steps"
                break;
            default:
                document.getElementById("data-input-unit").innerText = ""
        }
    
    }

    function overlayOff() {
        document.getElementById("overlay").style.display = "none";
    }

    function checkValueInput() {
        console.log()
        if (document.getElementById("overlay-operation-info").value=="add" 
                && document.getElementById("overlay-number-input").value == ""){
            alert("Please input a value to record a new data entry!")
        }
    }
</script>

{{!-- DATE SCRIPT --}}
<script>
  const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
  const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']
  date =  new Date();
  week_day = days[date.getDay()];
  day = date.getDate();
  month = months[date.getMonth()];
  year = date.getFullYear();

  document.getElementById("week_day").innerHTML = week_day + ", ";
  document.getElementById("date").innerHTML = day + " " + month + " " + year;
</script>